<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<title>NL Frutas â€“ PriorizaÃ§Ã£o</title>

<style>
body {
  font-family: Arial, sans-serif;
  background: #f2f2f2;
  padding: 10px;
}
h1 {
  text-align: center;
}
.box {
  background: #fff;
  padding: 12px;
  margin-bottom: 12px;
  border-radius: 8px;
}
input, button, select {
  width: 100%;
  padding: 10px;
  margin-top: 6px;
  font-size: 16px;
}
button {
  background: #2e7d32;
  color: white;
  border: none;
  border-radius: 6px;
}
.ok {
  background: #1976d2;
}
.status-ok {
  color: green;
  font-weight: bold;
}
.status-pendente {
  color: orange;
  font-weight: bold;
}
.item {
  border-bottom: 1px solid #ddd;
  padding: 6px 0;
}
</style>
</head>

<body>

<h1>ðŸ“¦ NL Frutas â€“ PriorizaÃ§Ã£o</h1>

<div class="box">
  <label>UsuÃ¡rio</label>
  <select id="usuario">
    <option value="Amanda">Amanda</option>
    <option value="JoÃ£o">JoÃ£o</option>
  </select>

  <label>CÃ³digo do Produto</label>
  <input id="codProd">

  <label>Nome do Produto</label>
  <input id="nomeProd">

  <label>CÃ³digo da Loja</label>
  <input id="codCli">

  <label>Nome da Loja</label>
  <input id="nomeCli">

  <label>Quantidade</label>
  <input type="number" id="qtd">

  <button onclick="adicionar()">Adicionar</button>
</div>

<div class="box">
  <h3>ðŸ“‹ PendÃªncias</h3>
  <div id="lista"></div>
</div>

<script>
const API_URL = "https://script.google.com/macros/s/AKfycbz_xttgSN1o_xOCNm6ISuqiZCHrh0wNRD6dsoEl4NS7FjaOL_wCgpTRXSb5qeO_Ix8VXA/exec";

function adicionar() {
  const dados = {
    usuario: usuario.value,
    codProd: codProd.value,
    nomeProd: nomeProd.value,
    codCli: codCli.value,
    nomeCli: nomeCli.value,
    qtd: qtd.value
  };

  fetch(API_URL + "?action=adicionar", {
    method: "POST",
    body: JSON.stringify(dados)
  }).then(() => {
    limpar();
    carregar();
  });
}

function limpar() {
  codProd.value = "";
  nomeProd.value = "";
  codCli.value = "";
  nomeCli.value = "";
  qtd.value = "";
}

function carregar() {
  fetch(API_URL + "?action=listar")
    .then(r => r.json())
    .then(dados => {
      lista.innerHTML = "";
      dados.forEach((l, i) => {
        const status = l[0];
        const texto = `
          <div class="item">
            <span class="${status === 'âœ…' ? 'status-ok' : 'status-pendente'}">
              ${status}
            </span>
            ${l[2]} â†’ ${l[4]} â†’ ${l[5]}
            ${status !== 'âœ…'
              ? `<br><button class="ok" onclick="marcarOK(${i})">OK</button>`
              : `<br><small>Confirmado por ${l[6]}</small>`
            }
          </div>`;
        lista.innerHTML += texto;
      });
    });
}

function marcarOK(linha) {
  fetch(API_URL + "?action=marcarOK", {
    method: "POST",
    body: JSON.stringify({
      linha: linha,
      usuario: usuario.value
    })
  }).then(() => carregar());
}

setInterval(carregar, 5000);
carregar();
</script>

</body>
</html>
function buscarBaseDados() {
  const sheet = SpreadsheetApp.getActive()
    .getSheetByName("BASE_DADOS");

  return sheet.getDataRange().getValues();
}


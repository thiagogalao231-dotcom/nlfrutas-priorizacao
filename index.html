<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>Prioriza√ß√£o NL Frutas</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <style>
    body {
      font-family: Arial, sans-serif;
      background: #f4f6f8;
      padding: 15px;
    }
    h2 {
      text-align: center;
      color: #2e7d32;
    }
    input, button {
      width: 100%;
      padding: 10px;
      margin-top: 8px;
      font-size: 16px;
    }
    button {
      background: #2e7d32;
      color: white;
      border: none;
      border-radius: 4px;
    }
    button.ok {
      background: #1565c0;
    }
    .box {
      background: white;
      padding: 15px;
      border-radius: 6px;
      margin-bottom: 15px;
    }
    .lista {
      border-bottom: 1px solid #ddd;
      padding: 10px 0;
    }
    .produto {
      font-weight: bold;
    }
  </style>
</head>

<body>

<h2>üì¶ Prioriza√ß√£o NL Frutas</h2>

<div class="box">
  <input type="number" id="codProd" placeholder="C√≥digo do produto">
  <button onclick="buscarProduto()">Buscar Produto</button>

  <p id="nomeProduto"></p>

  <input type="number" id="codCli" placeholder="C√≥digo do cliente">
  <input type="text" id="nomeCliente" placeholder="Nome da loja">
  <input type="number" id="quantidade" placeholder="Quantidade que falta">

  <button onclick="salvar()">Adicionar Prioridade</button>
</div>

<div class="box">
  <h3>‚è≥ Pendentes</h3>
  <div id="lista"></div>
</div>

<script>
  let produtoAtual = null;

  function buscarProduto() {
    const cod = document.getElementById('codProd').value;
    google.script.run.withSuccessHandler(res => {
      if (!res) {
        alert('Produto n√£o encontrado');
        return;
      }
      produtoAtual = res;
      document.getElementById('nomeProduto').innerHTML =
        'Produto: <b>' + res.nomeProduto + '</b>';
    }).buscarProduto(cod);
  }

  function salvar() {
    if (!produtoAtual) {
      alert('Busque o produto primeiro');
      return;
    }

    const dados = {
      codCli: document.getElementById('codCli').value,
      nomeCliente: document.getElementById('nomeCliente').value,
      codProd: produtoAtual.codProd,
      nomeProduto: produtoAtual.nomeProduto,
      quantidade: document.getElementById('quantidade').value
    };

    google.script.run.withSuccessHandler(() => {
      alert('Prioridade salva');
      carregarPendentes();
    }).salvarPrioridade(dados);
  }

  function carregarPendentes() {
    google.script.run.withSuccessHandler(res => {
      const div = document.getElementById('lista');
      div.innerHTML = '';
      res.forEach((l, i) => {
        div.innerHTML += `
          <div class="lista">
            <div class="produto">${l[4]}</div>
            Loja: ${l[2]} | Qtde: ${l[5]}
            <br>
            <button class="ok" onclick="ok(${i + 2})">OK</button>
          </div>
        `;
      });
    }).listarPendentes();
  }

  function ok(linha) {
    google.script.run.withSuccessHandler(() => {
      carregarPendentes();
    }).marcarOk(linha);
  }

  carregarPendentes();
</script>

</body>
</html>

